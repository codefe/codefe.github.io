{"sta":1,"data":{"subTitle":"Vue页面骨架屏","content":"<p>vue项目中的入口index.html只有简单的内容，当js执行完之后，会用vue渲染成的dom将div#root完全替换掉。</p><p>我们在div#root中加入模拟骨架屏</p><pre><code>&lt;div id=\"root\"&gt;\n    这里是骨架屏\n&lt;/div&gt;</code></pre><h3>使用vue-server-renderer来实现骨架屏</h3><p>我们需要骨架屏也是一个单独的.vue文件，因此我们需要用到vue-server-renderer。对vue服务端渲染有所了解的同学一定知道，这个插件能够将vue项目在node端打包成一个bundle，然后由bundle生成对应的html。<br>首先是生成项目：<br></p><pre><code>.\n├── build\n│   ├── webpack.config.client.js\n│   └── webpack.config.server.js\n├── src\n│   └── views\n│        ├── index\n│        │   └── index.vue\n│        ├── skeleton\n│        │   └── skeleton.vue\n│        ├── app.vue\n│        ├── index.js\n│        └── skeleton-entry.js\n├── index.html\n└── skeleton.js\n└── package.json</code></pre><p>vue的服务端渲染一般会用vue-server-renderer将整个项目在node端打包成一份bundle，而这里我们只要一份有骨架屏的html，所以会有一个单独的骨架屏入口文件skeleton-entry.js,一个骨架屏打包webpack配置webpack.config.server.js，而skeleton.js作用是将webpack打包出来的bundle写入到index.html中。<br></p><pre><code>//skeleton-entry.js\nimport Vue from 'vue'\nimport Skeleton from './views/skeleton/skeleton.vue'\n\nexport default new Vue({\n  components: {\n    Skeleton\n  },\n  template: '&lt;skeleton /&gt;'\n})</code></pre><pre><code>//webpack.config.server.js\nconst path = require('path')\nconst { VueLoaderPlugin } = require('vue-loader')\nconst VueSSRServerPlugin = require('vue-server-renderer/server-plugin')\n\nmodule.exports = {\n  mode: process.env.NODE_ENV,\n  target: 'node',\n  entry: path.join(__dirname, '../src/skeleton-entry.js'),\n  output: {\n    path: path.join(__dirname, '../server-dist'),\n    filename: 'server.bundle.js',\n    libraryTarget: 'commonjs2'\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.vue$/,\n        loader: 'vue-loader'\n      },\n      {\n        test: /\\.css$/,\n        use: [\n          'vue-style-loader',\n          'css-loader'\n        ]\n      }    \n    ]\n  },\n  externals: Object.keys(require('../package.json').dependencies),\n  resolve: {\n    alias: {\n      'vue$': 'vue/dist/vue.esm.js'\n    }\n  },\n  plugins: [\n    new VueLoaderPlugin(),\n    new VueSSRServerPlugin({\n      filename: 'skeleton.json'\n    })\n  ]\n}</code></pre><p>其中骨架屏的webpack配置因为是node端，所以需要target: 'node' libraryTarget: 'commonjs2'。在VueSSRServerPlugin中，指定了其输出的json文件名。当执行webpack会在/server-dist目录下生成一个skeleton.json文件,这个文件记载了骨架屏的内容和样式，会提供给vue-server-renderer使用。<br><br></p><pre><code>//skeleton.js\nconst fs = require('fs')\nconst path = require('path')\n\nconst createBundleRenderer = require('vue-server-renderer').createBundleRenderer\n\n// 读取`skeleton.json`，以`index.html`为模板写入内容\nconst renderer = createBundleRenderer(path.join(__dirname, './server-dist/skeleton.json'), {\n  template: fs.readFileSync(path.join(__dirname, './index.html'), 'utf-8')\n})\n\n// 把上一步模板完成的内容写入（替换）`index.html`\nrenderer.renderToString({}, (err, html) =&gt; {\n  fs.writeFileSync('index.html', html, 'utf-8')\n})</code></pre><blockquote>注意，作为模板的html文件，需要在被写入内容的位置添加&lt;!--vue-ssr-outlet--&gt;占位符，本例子在div#root里写入：</blockquote><pre><code>&lt;div id=\"root\"&gt;\n &lt;!--vue-ssr-outlet--&gt;\n&lt;/div&gt;</code></pre><p>最后执行node skeleton就能实现vue的骨架屏。\n<br>最终的index.html:</p><pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"zh-CN\"&gt;\n&lt;head&gt;\n    &lt;meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\"&gt;\n    &lt;title&gt;Document&lt;/title&gt;\n&lt;style data-vue-ssr-id=\"a7049cb4:0\"&gt;\n.skeleton[data-v-61761ff8] {\n  position: relative;\n  height: 100%;\n  overflow: hidden;\n  padding: 15px;\n  box-sizing: border-box;\n  background: #fff;\n}\n.skeleton-nav[data-v-61761ff8] {\n  height: 45px;\n  background: #eee;\n  margin-bottom: 15px;\n}\n.skeleton-swiper[data-v-61761ff8] {\n  height: 160px;\n  background: #eee;\n  margin-bottom: 15px;\n}\n.skeleton-tabs[data-v-61761ff8] {\n  list-style: none;\n  padding: 0;\n  margin: 0 -15px;\n  display: flex;\n  flex-wrap: wrap;\n}\n.skeleton-tabs-item[data-v-61761ff8] {\n  width: 25%;\n  height: 55px;\n  box-sizing: border-box;\n  text-align: center;\n  margin-bottom: 15px;\n}\n.skeleton-tabs-item span[data-v-61761ff8] {\n  display: inline-block;\n  width: 55px;\n  height: 55px;\n  border-radius: 55px;\n  background: #eee;\n}\n.skeleton-banner[data-v-61761ff8] {\n  height: 60px;\n  background: #eee;\n  margin-bottom: 15px;\n}\n.skeleton-productions[data-v-61761ff8] {\n  height: 20px;\n  margin-bottom: 15px;\n  background: #eee;\n}\n&lt;/style&gt;&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"root\"&gt;\n        &lt;div data-server-rendered=\"true\" class=\"skeleton page\" data-v-61761ff8&gt;&lt;div class=\"skeleton-nav\" data-v-61761ff8&gt;&lt;/div&gt; &lt;div class=\"skeleton-swiper\" data-v-61761ff8&gt;&lt;/div&gt; &lt;ul class=\"skeleton-tabs\" data-v-61761ff8&gt;&lt;li class=\"skeleton-tabs-item\" data-v-61761ff8&gt;&lt;span data-v-61761ff8&gt;&lt;/span&gt;&lt;/li&gt;&lt;li class=\"skeleton-tabs-item\" data-v-61761ff8&gt;&lt;span data-v-61761ff8&gt;&lt;/span&gt;&lt;/li&gt;&lt;li class=\"skeleton-tabs-item\" data-v-61761ff8&gt;&lt;span data-v-61761ff8&gt;&lt;/span&gt;&lt;/li&gt;&lt;li class=\"skeleton-tabs-item\" data-v-61761ff8&gt;&lt;span data-v-61761ff8&gt;&lt;/span&gt;&lt;/li&gt;&lt;li class=\"skeleton-tabs-item\" data-v-61761ff8&gt;&lt;span data-v-61761ff8&gt;&lt;/span&gt;&lt;/li&gt;&lt;li class=\"skeleton-tabs-item\" data-v-61761ff8&gt;&lt;span data-v-61761ff8&gt;&lt;/span&gt;&lt;/li&gt;&lt;li class=\"skeleton-tabs-item\" data-v-61761ff8&gt;&lt;span data-v-61761ff8&gt;&lt;/span&gt;&lt;/li&gt;&lt;li class=\"skeleton-tabs-item\" data-v-61761ff8&gt;&lt;span data-v-61761ff8&gt;&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt; &lt;div class=\"skeleton-banner\" data-v-61761ff8&gt;&lt;/div&gt; &lt;div class=\"skeleton-productions\" data-v-61761ff8&gt;&lt;/div&gt;&lt;div class=\"skeleton-productions\" data-v-61761ff8&gt;&lt;/div&gt;&lt;div class=\"skeleton-productions\" data-v-61761ff8&gt;&lt;/div&gt;&lt;div class=\"skeleton-productions\" data-v-61761ff8&gt;&lt;/div&gt;&lt;div class=\"skeleton-productions\" data-v-61761ff8&gt;&lt;/div&gt;&lt;div class=\"skeleton-productions\" data-v-61761ff8&gt;&lt;/div&gt;&lt;/div&gt;\n    &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;</code></pre><p><br></p><p><br></p>"}}