{"sta":1,"data":{"subTitle":"自动生成雪碧图","content":"<p>默认 src/assets/icons 中存放需要生成雪碧图的 png 文件。首次运行 npm run serve/build 会生成雪碧图，并在跟目录生成 icons.json 文件。再次运行命令时，会对比 icons 目录内文件与 icons.json 的匹配关系，确定是否需要再次执行 webpack-spritesmith 插件。<br></p><blockquote>npm i -D webpack-spritesmith</blockquote><pre><code>let has_sprite = true;\nlet files = [];\nconst icons = {};\n\ntry {\n  fs.statSync(resolve(\"./src/assets/icons\"));\n  files = fs.readdirSync(resolve(\"./src/assets/icons\"));\n  files.forEach(item =&gt; {\n    let filename = item.toLocaleLowerCase().replace(/_/g, \"-\");\n    icons[filename] = true;\n  });\n\n} catch (error) {\n  fs.mkdirSync(resolve(\"./src/assets/icons\"));\n}\n\nif (!files.length) {\n  has_sprite = false;\n} else {\n  try {\n    let iconsObj = fs.readFileSync(resolve(\"./icons.json\"), \"utf8\");\n    iconsObj = JSON.parse(iconsObj);\n    has_sprite = files.some(item =&gt; {\n      let filename = item.toLocaleLowerCase().replace(/_/g, \"-\");\n      return !iconsObj[filename];\n    });\n    if (has_sprite) {\n      fs.writeFileSync(resolve(\"./icons.json\"), JSON.stringify(icons, null, 2));\n    }\n  } catch (error) {\n    fs.writeFileSync(resolve(\"./icons.json\"), JSON.stringify(icons, null, 2));\n    has_sprite = true;\n  }\n}\n\n// 雪碧图样式处理模板\nconst SpritesmithTemplate = function(data) {\n  // pc\n  let icons = {};\n  let tpl = `.ico { \n  display: inline-block; \n  background-image: url(${data.sprites[0].image}); \n  background-size: ${data.spritesheet.width}px ${data.spritesheet.height}px; \n}`;\n\n  data.sprites.forEach(sprite =&gt; {\n    const name = \"\" + sprite.name.toLocaleLowerCase().replace(/_/g, \"-\");\n    icons[`${name}.png`] = true;\n    tpl = `${tpl} \n.ico-${name}{\n  width: ${sprite.width}px; \n  height: ${sprite.height}px; \n  background-position: ${sprite.offset_x}px ${sprite.offset_y}px;\n}\n`;\n  });\n  return tpl;\n};\n\nmodule.exports = {\n  configureWebpack: config =&gt; {\n    const plugins = [];\n    if (has_sprite) {\n      plugins.push(\n        new SpritesmithPlugin({\n          src: {\n            cwd: path.resolve(__dirname, \"./src/assets/icons/\"), // 图标根路径\n            glob: \"**/*.png\" // 匹配任意 png 图标\n          },\n          target: {\n            image: path.resolve(__dirname, \"./src/assets/images/sprites.png\"), // 生成雪碧图目标路径与名称\n            // 设置生成CSS背景及其定位的文件或方式\n            css: [\n              [\n                path.resolve(__dirname, \"./src/assets/scss/sprites.scss\"),\n                {\n                  format: \"function_based_template\"\n                }\n              ]\n            ]\n          },\n          customTemplates: {\n            function_based_template: SpritesmithTemplate\n          },\n          apiOptions: {\n            cssImageRef: \"../images/sprites.png\" // css文件中引用雪碧图的相对位置路径配置\n          },\n          spritesmithOptions: {\n            padding: 2\n          }\n        })\n      );\n    }\n\n    config.plugins = [...config.plugins, ...plugins];\n  }\n};</code></pre><p><br></p>"}}