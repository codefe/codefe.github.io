{"sta":1,"data":{"subTitle":"JS获取视频封面","content":"<p>上传视频之前浏览器在本地获取视频的封面,代码如下<br></p><pre>&lt;input type=\"file\" onchange=\"update(this)\" accept=\"video/*\"&gt;\n\n&lt;script&gt;\n// 获取文件\nfunction update(file) {\n    if (file.files.length) {\n        getVideoImage(file.files[0], function(a) {\n            console.log(a);\n            var img = document.createElement('img');\n            img.title = a.currentTime;\n            img.src = a.url;\n            document.body.appendChild(img);\n        });\n    }\n    file.value = null;\n}\n\n// 文件转 图片 关键函数  异步\nfunction getVideoImage(file, call) {\n    if (file &amp;&amp; file.type.indexOf('video/') == 0) {\n        var video = document.createElement('video');\n        video.src = URL.createObjectURL(file);\n        video.addEventListener('loadeddata', function() {\n          this.currentTime = 1\n        })\n        video.addEventListener('seeked', function () {\n            this.width = this.videoWidth;\n            this.height = this.videoHeight;\n            var canvas = document.createElement('canvas');\n            var ctx = canvas.getContext('2d');\n            canvas.width = this.width;\n            canvas.height = this.height;\n            ctx.drawImage(this, 0, 0, canvas.width, canvas.height);\n            var image = {\n                url: canvas.toDataURL('image/jpeg', 1),\n                width: this.width,\n                height: this.height,\n                currentTime: this.currentTime,\n                duration: this.duration\n            };\n            canvas.toBlob(function(blob) {\n                image.blob = blob;\n                typeof call == 'function' ? call.call(file, image) : console.log(image);\n            }, 'image/jpeg');\n        });\n    }\n}\n&lt;/script&gt;</pre><p>返回数据如下：</p><pre>{\n    \"url\": \"data:image/jpeg;base64,/9j/4AAQSk.......\",\n    \"width\": 654,\n    \"height\": 368,\n    \"currentTime\": 0,\n    \"duration\": 187.14202,\n    \"blob\": Blob\n}</pre><p>其中 url为 Base64 Url 字符串 可用于 src 本地提前展示<br>blob 字段 为 Blob 对象 可以直接用于异步上传<br>currentTime 为截图时间<br>duration 视频时长</p>"}}