{"sta":1,"data":{"subTitle":"原生js实现碰撞反弹球特效","content":"<h3>实现思路</h3><p>首先就要搞清楚一个小球是怎么去运动的。要想让小球动起来，最常用的就是两种方法，一种是要改变小球的margin值，使小球移动，还有一种就是利用position定位，让小球动起来。我用了position定位的方法。我们可以利用计时器控制小球left和top值的变化，是小球一直移动。解决了小球移动的问题，第二个问题就是方向的变化，对小球的位置进行一个判断，二维空间内，小球的运动可以分解为x方向和y方向上的运动，所以我们可以分别设置一个flag标记，对小球的位置进行判断，等小球到达边界时，就改变flag的值，使小球的运动方向发生改变。</p><p>实现了一个小球的运动，再去实现多个小球就容易啦，首先，我先创建了一个数组，数组中的每一个元素都存一个对象，每个对象均包括一个x（小球的初始x值），y（小球的初始y值），cx（圆心x坐标），cy（圆心y坐标），movex（小球x轴运动方向），movey（小球y轴运动方向），bgcolor（小球的背景颜色），speed（小球运动速度），timer（小球运动计时器，每一个小球需要一个计时器控制这个小球的运动），index （小球的索引值）。&nbsp;<br>给每一个对象绑定一个计时器，这样小球就可以动起来啦~</p><p>现在每一个小球都可以动啦，我们可以继续优化，实现小球的碰撞反弹。博主的物理学的不大好，也比较懒，所以对于小球的反弹，就比较简单粗暴的来写了。首先先比较小球啊与除了本身之外的其他所有小球的圆心距，如果圆心距小于一个小球的直径，即两个小球便会发生碰撞事件。（方向的改变仅仅考虑了简单碰撞后方向改变，并未考虑物理实际的碰撞反应，仅实现简单的方向改变，速度不会改变）</p><p>如果小球b处于小球a的正上或正下，便只改变小球a的movey，&nbsp;<br>如果小球b处在小球a的正左或正右，便只改变小球a的movex，&nbsp;<br>如果小球a处在小球b的左下方，小球a向左下移动，&nbsp;<br>如果小球a处在小球b的左上方，小球a向左上移动，&nbsp;<br>如果小球a处在小球b的右下方，小球a向右下移动，&nbsp;<br>如果小球a处在小球b的右上方，小球a向右上移动。</p><p></p><h3>实现代码</h3><pre><code>&lt;style&gt;\n\t*{margin: 0;\n\t\tpadding:0;}\n\t#main{margin: 0px auto;position: relative;}\n\t#main div{overflow: hidden;position: absolute;width:  200px;height: 200px;opacity: 0.5;\n\t\t-moz-border-radius: 50%;-webkit-border-radius: 50%;border-radius: 50%;}\n&lt;/style&gt;\n&lt;div id=\"main\"&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n\t&lt;div&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;script&gt;\n\tvar main = document.getElementById('main');\n\tvar circles = main.getElementsByTagName('div');\n\tvar st = [0,1,2,3,4,5,6,7,8,9,'a','b','c','d','e','f'];\n\tvar json = [],arr=[],color = [];\n\tvar maxW = 0;\n\tvar maxH = 0;\n\tvar cwidth = circles[0].offsetWidth;\n\tvar cheight = circles[0].offsetHeight;\n\t//根据浏览器窗口的大小自动调节小球的运动空间\n\twindow.onresize=function(){\n\t\tvar main = document.getElementById('main');\n\t\tmaxW=window.innerWidth-circles[0].clientWidth;\n\t\tmaxH=window.innerHeight-circles[0].clientHeight;\n\t\tmain.style.width = window.innerWidth+'px';\n\t\tmain.style.height = window.innerHeight+'px';\n\n\t}\n\tonresize();\n\t//数组对象的初始化\n\tfor(var i=0;i&lt;circles.length;i++){\n\t\tarr=[];\n\t\tfor(var j=0;j&lt;6;j++){\n\t\t\tcolor[j] = st[Math.floor(Math.random()*16)];\n\t\t}\n\t\tarr.x = Math.floor(Math.random()*(maxW+1));//初始x坐标\n\t\tarr.y = Math.floor(Math.random()*(maxH+1));//初始y坐标\n\t\tarr.cx = arr.x + circles[0].offsetWidth/2;//圆心x坐标\n\t\tarr.cy = arr.y + circles[0].offsetHeight/2;//圆心y坐标\n\t\tarr.movex = Math.floor(Math.random()*2);//x轴移动方向\n\t\tarr.movey = Math.floor(Math.random()*2);//y轴移动方向\n\t\tarr.bgolor = '#'+ color.join('');//随机生成一个6位字符串\n\t\tarr.speed = 2+Math.floor(Math.random()*5);\n\t\t//随机生成一个2~6之间的移动速度（如果设置的改变速度太大，容易造成小球碰撞时两个小球之间有重合，也有可能小球会出界）\n\t\tarr.timer = null;//计时器\n\t\tarr.index = i;//索引值\n\t\tjson.push(arr);\n\t\tcircles[i].style.left = arr.x + 'px';//小球位置初始化\n\t\tcircles[i].style.top = arr.y + 'px';//小球位置初始化\n\t\tcircles[i].style.backgroundColor = arr.bgolor;//小球背景颜色初始化\n\t}\n\t//碰撞函数\n\tfunction crash(a){\n\t\tvar ball1x = json[a].cx;\n\t\tvar ball1y = json[a].cy;\n\t\tfor(var i= 0;i&lt;json.length;i++){\n\t\t\tif(i!=a){\n\t\t\t\tvar ball2x = json[i].cx;\n\t\t\t\tvar ball2y = json[i].cy;\n\t\t\t\t//圆心距离的平方\n\t\t\t\tvar len = (ball1x-ball2x)*(ball1x-ball2x)+(ball1y-ball2y)*(ball1y-ball2y);\n\t\t\t\tif(len &lt;= cwidth*cwidth){\n\t\t\t\t//小球位置的判断，发生碰撞反应\n\t\t\t\t\tif(ball1x &gt;ball2x){\n\t\t\t\t\t\tif(ball1y &gt; ball2y){\n\t\t\t\t\t\t\tjson[a].movex=1;\n\t\t\t\t\t\t\tjson[a].movey=1;\n\t\t\t\t\t\t}else if(ball1y &lt; ball2y){\n\t\t\t\t\t\t\tjson[a].movex=1;\n\t\t\t\t\t\t\tjson[a].movey=0;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tjson[a].movex=1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}else if(ball1x &lt; ball2x){\n\t\t\t\t\t\tif(ball1y &gt; ball2y){\n\t\t\t\t\t\t\tjson[a].movex=0;\n\t\t\t\t\t\t\tjson[a].movey=0;\n\t\t\t\t\t\t}else if(ball1y &lt; ball2y){\n\t\t\t\t\t\t\tjson[a].movex=0;\n\t\t\t\t\t\t\tjson[a].movey=1;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tjson[a].movex=0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\tif(ball1y &gt; ball2y){\n\t\t\t\t\t\t\tjson[a].movey=1;\n\t\t\t\t\t\t}else if(ball1y &lt; ball2y){\n\t\t\t\t\t\t\tjson[a].movey=0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\t//移动函数\n\tfunction move(circle){\n\t\tcircle.timer = setInterval(function () {\n\t\t\tif(circle.movex == 1){\n\t\t\t\tcircle.x+=circle.speed;\n\t\t\t\tif(circle.x+circle.speed &gt;= maxW){//防止小球出界\n\t\t\t\t\tcircle.x = maxW;\n\t\t\t\t\tcircle.movex=0;//小球运动方向发生改变\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcircle.x-=circle.speed;\n\t\t\t\tif(circle.x-circle.speed &lt;= 0){\n\t\t\t\t\tcircle.x = 0;\n\t\t\t\t\tcircle.movex=1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(circle.movey == 1){\n\t\t\t\tcircle.y += circle.speed;\n\t\t\t\tif(circle.y+circle.speed &gt;= maxH){\n\t\t\t\t\tcircle.y = maxH;\n\t\t\t\t\tcircle.movey=0;\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcircle.y-=circle.speed;\n\t\t\t\tif(circle.y-circle.speed &lt;= 0){\n\t\t\t\t\tcircle.y = 0;\n\t\t\t\t\tcircle.movey=1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcircle.cx = circle.x + circles[0].offsetWidth/2;//小球每一次运动圆心都会发生改变\n\t\t\tcircle.cy = circle.y + circles[0].offsetHeight/2;\n\t\t\tcircles[circle.index].style.left = circle.x + 'px';//小球位置重定位\n\t\t\tcircles[circle.index].style.top = circle.y + 'px';\n\t\t\t/*console.log('x'+circle.cx+'y'+circle.cy);*/\n\t\t\tcrash(circle.index);\n\t\t},15);\n\t}\n\t//对每一个小球绑定计时器，让小球动起来\n\tfor(var i=0;i&lt;circles.length;i++){\n\t\tmove(json[i]);\n\t}\n&lt;/script&gt;</code></pre><p><br></p>"}}