{"sta":1,"data":{"subTitle":"同页面的Web Worker","content":"<p>通常情况下，Worker 载入的是一个单独的 JavaScript 脚本文件，但是也可以载入与主线程在同一个网页的代码。</p><pre><code>&lt;!DOCTYPE html&gt;\n  &lt;body&gt;\n    &lt;script id=\"worker\" type=\"app/worker\"&gt;\n      addEventListener('message', function () {\n        postMessage('some message');\n      }, false);\n    &lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;</code></pre><p>上面是一段嵌入网页的脚本，注意必须指定&lt;script&gt;标签的type属性是一个浏览器不认识的值，上例是app/worker。<br></p><p>\n<br>然后，读取这一段嵌入页面的脚本，用 Worker 来处理。\n<br>\n</p><pre><code>var blob = new Blob([document.querySelector('#worker').textContent]);\nvar url = window.URL.createObjectURL(blob);\nvar worker = new Worker(url);\n\nworker.onmessage = function (e) {\n  // e.data === 'some message'\n};</code></pre><p><br></p><p>上面代码中，先将嵌入网页的脚本代码，转成一个二进制对象，然后为这个二进制对象生成 URL，再让 Worker 加载这个 URL。这样就做到了，主线程和 Worker 的代码都在同一个网页上面。</p>"}}