{"sta":1,"data":{"subTitle":"Koa2 分页插件 jqPaginator","content":"<h3>一、数据库分页查询数据的原理算法</h3><p>\n<br><h4>规则：规定每页20条数据的查询方式\n</h4>\n<br>查询第一页（page=1）:\n<br>db.表名.find().skip(0).limit(20)\n<br><br>查询第二页（page=2）:\n<br>db.表名.find().skip(20).limit(20)\n<br><br>查询第三页（page=3）:\n<br>db.表名.find().skip(40).limit(20)\n<br><br><h4>规则：规定每页8条数据的查询方式\n</h4>\n<br>查询第一页（page=1）:\n<br>db.表名.find().skip(0).limit(8)\n<br><br>查询第二页（page=2）:\n<br>db.表名.find().skip(8).limit(8)\n<br><br>查询第三页（page=3）:\n<br>db.表名.find().skip(16).limit(8)\n<br><br>查询第四页（page=4）:\n<br>db.表名.find().skip(24).limit(8)\n<br>\n<br><br><h4>总结：分页查询的sql语句</h4><blockquote>db.表名.find().skip((page-1)*pageSize).limit(pageSize)\n</blockquote>\n<br><br><h3>二、数据库分页方法封装\n</h3>\n<br><h4>find方法封装</h4><blockquote>db.collection(collectionName).find(json1,{fields:attr}).skip(slipNum).limit(pageSize);\n</blockquote>\n<br><h4>count方法封装</h4><blockquote>var result=  db.collection(collectionName).count(json);<br>\nresult.then(function(data){<br>\n&nbsp; &nbsp; resolve(data);<br>\n})\n</blockquote>\n<br><h3>三、Koa2 结合jqPaginator实现分页</h3><h4>对应路由：\n</h4>\n</p><pre>router.get('/',async (ctx)=&gt;{\n    var page=ctx.query.page ||1;\n    var pageSize=5;\n    //查询总数量\n    var count= await  DB.count('article',{});\n    var result=await DB.find('article',{},{},{\n        page:page,\n        pageSize:pageSize\n    });\n    await  ctx.render('admin/article/index',{\n        list: result,\n        page:page,\n        totalPages:Math.ceil(count/pageSize)\n    });\n})</pre><p><br></p><p><h4>对应模板中：</h4>    定义一个div  注意 class为bootstrap的分页calss<br><blockquote>      &lt;div id=\"page\" class=\"pagination\"&gt;&lt;/div&gt;\n</blockquote>\n<br><h4>    然后复制下面代码\n</h4></p><pre>&lt;script src=\"{{__HOST__}}/admin/jqPaginator.js\"&gt;&lt;/script&gt;\n\n&lt;script&gt;\n    $('#page').jqPaginator({\n        totalPages: {{totalPages}},\n        visiblePages: 8,\n        currentPage: {{page}},\n        onPageChange: function (num, type) {\n            console.log(num, type);\n//\n            if(type=='change'){\n                location.href=\"{{__HOST__}}/admin/article?page=\"+num;\n            }\n        }\n    });\n&lt;/script&gt;</pre><p><br></p>"}}