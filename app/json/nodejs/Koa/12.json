{"sta":1,"data":{"subTitle":"Koa上传图片模块koa-multer的使用","content":"<p>koa-multer是一个 node.js 中间件，用于处理 multipart/form-data 类型的表单数据，它主要用于上传文件。它是写在 busboy 之上非常高效。<br></p><p><blockquote>注意: Multer 不会处理任何非 multipart/form-data 类型的表单数据，意思就是我们要上传图片必须在form表单上面加  multipart/form-data\n</blockquote>\n<br><h3>安装koa-multer\n</h3><blockquote>npm install --save multer\n</blockquote>\n<br><h3>引入配置koa-multer模块&nbsp;</h3></p><pre>const multer = require('koa-multer');\n//配置    \nvar storage = multer.diskStorage({\n    //文件保存路径\n    destination: function (req, file, cb) {\n        cb(null, 'public/uploads/')  //注意路径必须存在\n    },\n    //修改文件名称\n    filename: function (req, file, cb) {\n        var fileFormat = (file.originalname).split(\".\");\n        cb(null,Date.now() + \".\" + fileFormat[fileFormat.length - 1]);\n    }\n})\n\n\n//加载配置\nvar upload = multer({ storage: storage })</pre><h3>使用koa-multer</h3><pre>router.post('/doAdd', upload.single('face'), async (ctx, next) =&gt; {\n    ctx.body = {\n        filename: ctx.req.file.filename,//返回文件名\n        body:ctx.req.body\n    }\n});</pre><h3>使用koa-multer 上传多个图片</h3><pre>router.post('/doAdd', upload.fields([{ name: 'pic', maxCount: 1 }, { name: 'aaa', maxCount: 1 }]),async (ctx)=&gt;{\n\n    console.log(ctx.req.files);\n})</pre><p><br></p><blockquote><font color=\"#c24f4a\">注意Form表单加上enctype=\"multipart/form-data\"</font></blockquote><p><br></p><p><br></p>"}}