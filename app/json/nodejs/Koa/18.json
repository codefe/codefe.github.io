{"sta":1,"data":{"subTitle":"koa2 支付宝支付插件alipay-mobile","content":"<p>alipay-mobile 这个插件是Nodejs支付宝支付插件，它基于最新版蚂蚁金服 支付宝开发文档，koa2 支付宝支付插件alipay-mobile可以方便的实现PC端和移动端web支付。<br></p><p>alipay-mobile 不仅可以用在Nodejs中 也可以用在express中，更可以用在Koa2中。\n<br>\n<br>下面我们看看Koa2中如何实现支付宝支付。\n<br>\n<br><h3>一、Koa2接入支付宝准备工作：\n</h3>    1.必须注册企业支付宝账户，如果已有企业支付宝账户忽略此步骤\n<br>    2.百度搜索《支付宝开放平台》，或者点击下面链接进入支付宝开发接入页面：    https://open.alipay.com/developmentAccess/developmentAccess.htm\n<br>\n<br><h3>二、创建应用：</h3></p><p><img src=\"/app/json/nodejs/Koa/imgs/alipay-1.jpg\" style=\"max-width:100%;\"></p><h3>三、选择网页移动应用：</h3><img src=\"/app/json/nodejs/Koa/imgs/alipay-2.jpg\" style=\"max-width:100%;\"><p>&nbsp;\n<br><h3>四、创建以后进入下面页面。 上传应用图标</h3></p><img src=\"/app/json/nodejs/Koa/imgs/alipay-3.jpg\" style=\"max-width:100%;\"><p>&nbsp;\n<br><h3>五、设置应用公钥，然后提交审核。</h3></p><img src=\"/app/json/nodejs/Koa/imgs/alipay-4.png\" style=\"max-width:100%;\"><p>&nbsp;\n<br><h3>六、设置签名\n</h3>\n<br>\n<br>1.下载签名工具。\n<br>https://docs.open.alipay.com/291/106097/\n<br>\n<br>2.签名。并保存好私钥、公钥\n<br>\n<br>\n<br><h3>部分代码如下：</h3></p><pre>var router=require('koa-router')();\nconst DB=require('../module/db.js');\nconst config=require('../module/config.js');\nconst tools=require('../module/tools.js');\nconst feiyun=require('../module/feiyun.js');\n\n//支付宝\nconst Alipay = require('alipay-mobile');\n\nconst assert=require('assert');\n\n\n\nrouter.get('/doPay',(ctx)=&gt;{\n\n//appPrivKeyFile 本地生成的\n   // alipayPubKeyFile: 蚂蚁金服公钥   支付宝公钥\n     const options = {\n        app_id: '2017122101048570',\n        appPrivKeyFile: \"本地支付宝私钥\",\n        alipayPubKeyFile: \"支付宝公钥\"\n    }    \n   \n    const service = new Alipay(options);\n\n    const data = {\n        subject: 'aaa',\n        out_trade_no:'1234222232532235',\n        total_amount: '0.1'\n    }\n    const basicParams = {\n        \"return_url\": 'http://a.itying.com',\n        //异步通知地址\n\"notify_url\": \"http://a.itying.com/api/alipayNotify\",\n    }\n    return service.createWebOrderURL(data, basicParams)\n    .then(result =&gt; {\n        assert(result.code == 0, result.message)\n        assert(result.message == 'success', result.message)\n        console.log(result);\n        // ctx.body={\"title\":result};\n        ctx.redirect(result.data);\n       \n    })\n  \n})</pre><p><br></p><p><br></p>"}}